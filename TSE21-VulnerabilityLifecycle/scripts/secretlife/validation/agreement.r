if (!require(glue)) {
    install.packages("glue", repos = "http://cran.us.r-project.org")
    library(glue)
}
if (!require(psych)) {
    install.packages("psych", repos = "http://cran.us.r-project.org")
    library(psych)
}

in_filepath <- "../../../data/validation/alignment.csv"
out_filepath <- "../../../results/validation/agreement.txt"

df <- read.csv(in_filepath)
sample_size <- nrow(df)
cat("Sample Size:", sample_size, "\n", file=out_filepath)

out_file <- file(out_filepath, open="a")

# Agreement (Percentage)
disagreements <- sum(xor(df$inspector1, df$inspector2))
agreements <- sample_size - disagreements
cat("Percentage Agreement: ", round(agreements, digits=3),  "/", sample_size, " (",  round(agreements / sample_size * 100, digits=3),"%)\n", sep="", file=out_file)

# Agreement (Cohen's kappa)
kappa <- cohen.kappa(x=cbind(df$inspector1, df$inspector2))
kappa_statistic <- kappa$kappa
kappa_pvalue <- kappa$plevel
cat("Cohen's k = ", round(kappa_statistic, digits=3), " (p=", kappa_pvalue,")\n", sep="", file=out_file)
