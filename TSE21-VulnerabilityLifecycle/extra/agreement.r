if (!require(glue)) {
    install.packages("glue" ,repos = "http://cran.us.r-project.org")
    library(glue)
}
if (!require(psych)) {
    install.packages("psych" ,repos = "http://cran.us.r-project.org")
    library(psych)
}

in_filepath <- "../../../data/validation/vccs_mining_validation.csv"
out_filepath <- "../../../results/validation/output.txt"
df <- read.csv(in_filepath)
sample_size <- nrow(df)
cat("Sample Size:", sample_size, "\n", file=out_filepath)

out_file <- file(out_filepath, open = "a")

# Agreement (Percentage)
agreements <- df$inspector_1 * df$inspector_2
nr_agreements <- sum(agreements)
cat("Agreement: ", round(nr_agreements, digits=3),  "/", sample_size, " (",  round(nr_agreements / sample_size * 100, digits=3),"%)\n", sep="", file=out_file)

# Percentage of "Correct" of Final Outcomes 
correct <- sum(df$final_outcome)
cat("Precision (Post-Discussion): ", correct, "/", sample_size, " (", round(correct / sample_size * 100, digits=3), "%)\n", sep="", file=out_file)

# Agreement (Cohen's kappa)
kappa <- cohen.kappa(x=cbind(df$inspector_1, df$inspector_2))
kappa_statistic <- kappa$kappa
kappa_pvalue <- kappa$plevel
cat("k = ", round(kappa_statistic, digits=3), " (p=", kappa_pvalue,")\n", sep="", file=out_file)
